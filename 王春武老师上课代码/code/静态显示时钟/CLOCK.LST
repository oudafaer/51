C51 COMPILER V8.02   CLOCK                                                                 11/15/2010 16:57:08 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE CLOCK
OBJECT MODULE PLACED IN CLOCK.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE CLOCK.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*工作流程：状态0时 显示 DATA1的值，并得到SIGNE1*/
   2          /*状态1时 显示 DATA2的值，并得到SIGNE2*/
   3          /*状态2时 显示 DATA3的值，并得到SIGNE3*/
   4          /*功能上可以实现判断计算优先级*/
   5          
   6          #include  "reg51.h"
   7          
   8          /*P2 口 外接键盘 */
   9          
  10          
  11          /*进行端口设置*/
  12          /*矩阵按键键值分配*/
  13          
  14          sbit   SET=P2^0;         //设置开关
  15          sbit   ADD=P2^1;          //调整参数开关
  16          sbit   SUB=P2^2;    
  17          
  18          sbit   LOCK=     P3^2;
  19          sbit   CLK=      P3^1;
  20          sbit   DAT=      P3^0;
  21          
  22          sbit   red=      P3^7;
  23          sbit   green=    P3^6;
  24          sbit   yellow=   P3^5;
  25          sbit   speaker=  P1^0;
  26          
  27          unsigned char cnt,state;
  28          bit    sec,key_mark;
  29          
  30          void init_timer0()
  31          {
  32   1              TMOD=0X01;
  33   1              TH0=-50000>>8;
  34   1              TL0=-50000;
  35   1              IE=0X82;
  36   1              TR0=1;
  37   1      }
  38          
  39          void timer0()   interrupt 1
  40          {
  41   1              TH0=-50000>>8;
  42   1              TL0=-50000;
  43   1      
  44   1              if(++cnt>19)
  45   1          {
  46   2                  sec=1;
  47   2                      cnt=0;
  48   2              }       
  49   1      
  50   1      } 
  51          
  52          
  53          /*声明用来产生数码管的控制字*/
  54          unsigned char zxm[]={0x03,0x9f,0x25,0x0d,0x99,0x49,0x41,0x1f,0x01,0x09,0XFD,0XFF,0X61,0XF5,0XC5};
  55          //{0x11,0xd7,0x32,0x92,0xd4,0x98,0x18,0xd3,0x10,0x90,0xfe,0xff,0x38,0x7e,0x1e};
C51 COMPILER V8.02   CLOCK                                                                 11/15/2010 16:57:08 PAGE 2   

  56          char hour,minute,second;
  57          
  58          void delay()
  59          {
  60   1         char i,j;
  61   1      
  62   1         for(i=0;i<4;i++)
  63   1           for(j=0;j<100;j++);
  64   1      
  65   1      }
  66          void display()
  67          {
  68   1         unsigned char t[6]={0},i,j;
  69   1      
  70   1         t[0]=zxm[second%10];
  71   1         t[1]=zxm[second/10];
  72   1         t[2]=zxm[minute%10];
  73   1         t[3]=zxm[minute/10];
  74   1         t[4]=zxm[hour%10];
  75   1         t[5]=zxm[hour/10];
  76   1      
  77   1         if(state==1)
  78   1           t[0]=t[1]=t[2]=t[3]=0xff;
  79   1         else if(state==2)
  80   1           t[0]=t[1]=t[4]=t[5]=0xff;
  81   1         else if(state==3)
  82   1           t[4]=t[5]=t[2]=t[3]=0xff;
  83   1      
  84   1      
  85   1      
  86   1         LOCK=0;
  87   1      
  88   1         for(i=0;i<6;i++)
  89   1         {      
  90   2            for(j=0;j<8;j++)
  91   2                {
  92   3                   if(t[i]&1)
  93   3                         DAT=1;
  94   3                       else
  95   3                         DAT=0;
  96   3                       
  97   3                       CLK=0;
  98   3                       CLK=1;
  99   3                       
 100   3                       t[i]>>=1;      
 101   3                }
 102   2         }
 103   1         LOCK=1;
 104   1      
 105   1      
 106   1      }
 107          
 108          void key()
 109          {
 110   1         if(!SET)
 111   1         {
 112   2            if(++state>3)
 113   2                  state=0;
 114   2      
 115   2                if(state==0)
 116   2                  TR0=1;
 117   2            else 
C51 COMPILER V8.02   CLOCK                                                                 11/15/2010 16:57:08 PAGE 3   

 118   2                  TR0=0;
 119   2         }
 120   1         else if(!ADD)
 121   1         {
 122   2                if(state==1)
 123   2                 {
 124   3                        if(++hour>23)
 125   3                          hour=0;
 126   3                 }
 127   2                else if(state==2)
 128   2                {
 129   3                   if(++minute>59)
 130   3                          minute=0;
 131   3                }    
 132   2                else if(state==3)
 133   2                {
 134   3                   if(++second>59)
 135   3                         second=0;
 136   3                }
 137   2                
 138   2                 
 139   2         }
 140   1         else if(!SUB)
 141   1         {
 142   2                if(state==1)
 143   2                 {
 144   3                        if(--hour<0)
 145   3                          hour=23;
 146   3                 }
 147   2                else if(state==2)
 148   2                {
 149   3                   if(--minute<0)
 150   3                          minute=59;
 151   3                }    
 152   2                else if(state==3)
 153   2                {
 154   3                   if(--second<0)
 155   3                         second=59;
 156   3                }
 157   2         }
 158   1      
 159   1         display();
 160   1      }
 161          
 162          main()
 163          {
 164   1         init_timer0();
 165   1      
 166   1         hour=12;
 167   1         minute=0;
 168   1         second=0;
 169   1         state=0;
 170   1         display();
 171   1      
 172   1      
 173   1         while(1)
 174   1         {
 175   2      
 176   2                if((!SET || !ADD || !SUB) && !key_mark)
 177   2                {
 178   3                  delay();
 179   3                      if(!SET || !ADD || !SUB) 
C51 COMPILER V8.02   CLOCK                                                                 11/15/2010 16:57:08 PAGE 4   

 180   3                      {
 181   4                         key_mark=1;
 182   4                         key();
 183   4                         red=0;
 184   4                      }
 185   3                }
 186   2                else if(SET && ADD && SUB)
 187   2                {
 188   3                   key_mark=0;
 189   3                       red=1;
 190   3                }
 191   2      
 192   2            if(sec)
 193   2                {
 194   3                   sec=0;
 195   3                       if(++second>59)
 196   3                       {
 197   4                          second=0;
 198   4                              if(++minute>59)
 199   4                              {
 200   5                                 minute=0;
 201   5                                 if(++hour>23)
 202   5                                    hour=0;
 203   5                              }
 204   4                       }
 205   3      
 206   3                       display();
 207   3                }
 208   2         } 
 209   1      
 210   1      }
 211          
 212          
 213          
 214          
 215          
 216          
 217          
 218          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    539    ----
   CONSTANT SIZE    =      6    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     20       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
