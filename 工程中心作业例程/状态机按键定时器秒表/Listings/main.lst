C51 COMPILER V9.60.0.0   MAIN                                                              05/20/2022 16:15:49 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\MDK5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.ls
                    -t) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          
   3          #define uint unsigned int                                                 //对数据类型进行声明定义
   4          #define uchar unsigned char
   5          
   6          sbit LS138_A = P2^2;                                                      //138芯片A2引脚
   7          sbit LS138_B = P2^3;                                                      //138芯片A1引脚
   8          sbit LS138_C = P2^4;                                                      //138芯片A0引脚
   9          
  10          uchar DT_s = 0;                                                           //秒计时
  11          uchar DT_min = 0;                                                                         //分计时
  12          
  13          uchar code duan[] = {0x3F,0x06,0x5B,0x4F,                 //共阴数码管无小数点 显示0~9
  14                                                   0x66,0x6D,0x7D,0x07,
  15                                                   0x7F,0x6F      
  16                                                  };
  17          
  18          uchar code duanpoint[] = {0xbf,0x86,0xdb,0xcf,     //共阴数码管有小数点 显示0~9
  19                                                            0xe6,0xed,0xfd,0x87,
  20                                                            0xff,0xef,0xf7,0xfc,
  21                                                            0xb9,0xde,0xf9,0xf1
  22                                                           };
  23          
  24          /************************************************
  25          函数名                          ：delay1ms
  26          函数功能            ：t=1，大约延时1ms
  27          ************************************************/
  28          void delay1ms(uint t)
  29          {
  30   1              uint i,j;
  31   1              for(i=0;i<t;i++)
  32   1              {
  33   2                      for(j=0;j<120;j++);     
  34   2              }
  35   1      }
  36          
  37          /************************************************
  38          函数名                          ：Timer0Init
  39          函数功能                        :定时/计数器0中断初始化
  40          *************************************************/
  41          void Timer0Init()
  42          {
  43   1              TMOD = 0x01;            //选择T0定时/计数器，工作在方式1，16位计数器            
  44   1              TH0 = 0xFC;                     //计数初始值，计数从64536开始，计1000个数，完成一次计数，时间为1ms
  45   1              TL0 = 0x18;             
  46   1              ET0 = 1;                        //定时/计数器0中断允许位
  47   1              EA = 1;                         //总中断
  48   1      }
  49          
  50          /************************************************
  51          函数名                          ：S3
  52          函数功能                        ：按下按钮S3时，秒表归零
  53          *************************************************/
  54          void S3()
C51 COMPILER V9.60.0.0   MAIN                                                              05/20/2022 16:15:49 PAGE 2   

  55          {
  56   1              DT_s = 0;                       //秒归零
  57   1              DT_min = 0;                     //分归零
  58   1              TR0 = 0;                        //运行控制位清0，关闭定时器
  59   1      }
  60          
  61          extern unsigned char key_scanf()
  62          {
  63   1          unsigned char num_key=0;//按键号
  64   1          unsigned char temp=0;//用于读取 P3 线上按键值
  65   1          static unsigned char temp_code=0;//保存按键值
  66   1          static unsigned char num_check=0;//低电平有效次数
  67   1          static unsigned char key_flag=0;//按键有效标识
  68   1          temp=P3&0xF0;//读取 P3 线数据
  69   1          if(temp!=0xF0)//低电平判断
  70   1          {
  71   2              num_check++;
  72   2              if(num_check==10)//连续 10 次(10ms)低电平有效,则认为按键有效
  73   2              {
  74   3                  key_flag=1;//使能按键有效标识
  75   3                  temp_code=temp;//保存按键值
  76   3                      }
  77   2                      else//松手时判断
  78   2                      {
  79   3                              num_check=0;
  80   3                              if(key_flag==1)//按键有效
  81   3                              {
  82   4                                      key_flag=0;
  83   4                                      switch(temp_code)//读取按键号
  84   4                                      {
  85   5                                              case 0xE0: num_key=1;
  86   5                                              break;
  87   5                                              case 0xD0: num_key=2;
  88   5                                              break;
  89   5                                              case 0xB0: num_key=3;
  90   5                                              break;
  91   5                                              case 0x70: num_key=4;
  92   5                                              break;
  93   5                                      }
  94   4                              }
  95   3                      }
  96   2              }
  97   1          return (num_key);
  98   1      }
  99          
 100          void DisplayKey()
 101          {
 102   1              int key;
 103   1              key=key_scanf();
 104   1              if(key)  //确认按键被按下
 105   1              {
 106   2                      switch(key)
 107   2                      {
 108   3                              case 1:                           //S1（P3^2）被按下
 109   3                                                      TR0 = 1;          //定时器0运行控制位为1，启动定时器0
 110   3                                                      break;
 111   3                              case 2:                           //S2（P3^1）被按下
 112   3                                                      TR0 = 0;          //定时器0运行控制位为0，关闭定时器0
 113   3                                                      break;
 114   3                              case 3:                           //S3（P3^3）被按下
 115   3                                                      S3();
 116   3                                                      break;
C51 COMPILER V9.60.0.0   MAIN                                                              05/20/2022 16:15:49 PAGE 3   

 117   3                      }
 118   2              }
 119   1      }
 120          
 121          /*******************************************************************
 122          函数名                          ：DigDisplay
 123          函数功能                        ：数码管动态扫描函数，循环扫描8个数码管显示
 124          ********************************************************************/
 125          void DigDisplay(uchar s,uchar min)
 126          {
 127   1              LS138_A = 0;                      //秒个位位选
 128   1              LS138_B = 0;
 129   1              LS138_C = 0;
 130   1              P0 = duan[s%10];                  //发送段码，显示秒个位        
 131   1              delay1ms(5);                      //间隔一段时间扫描
 132   1              
 133   1              LS138_A = 1;                      //秒十位位选
 134   1              LS138_B = 0;
 135   1              LS138_C = 0;
 136   1              P0 = duan[s/10];                  //发送段码显示秒十位
 137   1              delay1ms(5);                      //间隔一段时间扫描
 138   1      
 139   1              LS138_A = 0;                      //分的个位位选
 140   1              LS138_B = 1;
 141   1              LS138_C = 0;
 142   1              P0 = duanpoint[min%10];           //发送段码，显示分的个位
 143   1              delay1ms(5);                      //间隔一段时间扫描
 144   1              
 145   1              LS138_A = 1;                      //分的十位位选
 146   1              LS138_B = 1;                      //间隔一段时间扫描
 147   1              LS138_C = 0;
 148   1              P0 = duan[min/10];                //发送段码，显示分的十位
 149   1              delay1ms(5);                      //间隔一段时间扫描
 150   1              P0 = 0x00;                                //消隐
 151   1      }
 152          
 153          /**********************************************************
 154          函数名                          ：主函数
 155          函数功能                        ：无
 156          **********************************************************/
 157          void main(void)
 158          {
 159   1              P0 = 0x00;                //读端口前写1
 160   1              P3 = 0xFF;                //读端口前写1
 161   1              Timer0Init();     //定时器中断初始化函数
 162   1              DisplayKey();
 163   1              while(1)
 164   1              {
 165   2                      DigDisplay(DT_s,DT_min);           //数码管显示函数
 166   2                      DisplayKey();                                      //按键扫描函数
 167   2              }
 168   1      }
 169          
 170          /**********************************************************
 171          函数名                          ：Timer0
 172          函数功能                        ：定时器计数
 173          **********************************************************/
 174          void Timer0() interrupt 1
 175          {
 176   1              static uint count_s;    
 177   1              static uint count_min;          
 178   1              TH0 = 0xFC;                             //计数值初始化，从64536开始计数，计满时为65536，溢出时即为 1ms
C51 COMPILER V9.60.0.0   MAIN                                                              05/20/2022 16:15:49 PAGE 4   

 179   1              TL0 = 0x18;
 180   1              count_s++;                               //秒计数
 181   1              count_min++;                             //分计数
 182   1              if(count_s==1000)                        //计数到1s时，秒计数器开始工作
 183   1              {
 184   2                      count_s = 0;             //秒计数清零
 185   2                      DT_s++;                  //显示秒计数值自增
 186   2                      if(DT_s>59)              //秒数最大为59
 187   2                      {
 188   3                              DT_s = 0;
 189   3                      }
 190   2              }
 191   1              if(count_min==60000)              //计数到60000ms时，秒计数器开始工作
 192   1              {
 193   2                      count_min = 0;            //分计数清零
 194   2                      DT_min++;                                 //显示分计数值自增
 195   2                      if(DT_min>59)                     //分数最大为59
 196   2                      {
 197   3                              DT_min = 0;
 198   3                      }
 199   2              }
 200   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    417    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
