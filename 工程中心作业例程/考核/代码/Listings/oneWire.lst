C51 COMPILER V9.59.0.0   ONEWIRE                                                           12/11/2021 16:42:35 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\oneWire.obj
COMPILER INVOKED BY: E:\SCM\keil 4\C51\BIN\C51.EXE oneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\oneWire.lst) OBJECT(.\Objects\oneWire.obj)

line level    source

   1          #include "reg52.h"
   2          sbit oneWire_DQ=P3^7;   //定义DS18B20总线I/O
   3          //单总线的初始化
   4          unsigned char Ds18b20Init()
   5          {
   6   1              unsigned char ACK;
   7   1              unsigned int i;
   8   1              oneWire_DQ=0;                    //将总线拉低
   9   1              i=70;   
  10   1              while(i--);             //延时642us
  11   1              oneWire_DQ=1;                   //将总线拉高
  12   1              i=0;
  13   1              while(oneWire_DQ)       //等待DS18B20拉低总线
  14   1              {
  15   2                      i++;
  16   2                      if(i>5000)          //等待>5MS
  17   2                              ACK=1;       //初始化失败       
  18   2              }
  19   1              ACK=0;               //初始化成功
  20   1              return ACK;
  21   1      }
  22          
  23          //写入一个字节
  24          void Ds18b20WriteByte(unsigned char dat)
  25          {
  26   1              unsigned int i,j;
  27   1              for(j=0;j<8;j++)
  28   1              {
  29   2                      oneWire_DQ=0;                   //每写入一位数据之前先把总线拉低1us
  30   2                      i++;
  31   2                      oneWire_DQ=dat&0x01; //然后写入一个数据，从最低位开始
  32   2                      i=6;
  33   2                      while(i--); //延时68us，持续时间最少60us
  34   2                      oneWire_DQ=1;   //释放总线
  35   2                      dat>>=1;        //延时
  36   2              }
  37   1      }
  38          //读取一个字节
  39          unsigned char Ds18b20ReadByte()
  40          {
  41   1              unsigned char byte,Bit;
  42   1              unsigned int i,j;       
  43   1              for(j=8;j>0;j--)
  44   1              {
  45   2                      oneWire_DQ=0;//将总线拉低
  46   2                      i++;
  47   2                      oneWire_DQ=1;//释放总线
  48   2                      i++;
  49   2                      i++;//延时6us等待数据稳定
  50   2                      Bit=oneWire_DQ;  //读取数据
  51   2                      byte=(byte>>1)|(Bit<<7);                                                  
  52   2                      i=4;                    //延时48微秒
  53   2                      while(i--);
  54   2              }                               
C51 COMPILER V9.59.0.0   ONEWIRE                                                           12/11/2021 16:42:35 PAGE 2   

  55   1              return byte;
  56   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    160    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
